#!/usr/bin/env bash
# Soul System - Main entry point
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

case "${1:-}" in
  up)
    echo "Starting Soul system..."
    docker compose -f "${SCRIPT_DIR}/docker-compose.yml" up -d
    echo "Soul system is running. Use './soul chat' to interact."
    ;;
  down)
    echo "Stopping Soul system..."
    docker compose -f "${SCRIPT_DIR}/docker-compose.yml" down
    ;;
  chat)
    shift || true
    exec bash "${SCRIPT_DIR}/gateway/soul-chat.sh" "$@"
    ;;
  logs)
    docker compose -f "${SCRIPT_DIR}/docker-compose.yml" logs -f "${@:2}"
    ;;
  rebuild)
    echo "Rebuilding Soul system..."
    docker compose -f "${SCRIPT_DIR}/docker-compose.yml" up -d --build
    ;;
  *)
    echo "Usage: ./soul <command>"
    echo ""
    echo "Commands:"
    echo "  up        Start the Soul system"
    echo "  down      Stop the Soul system"
    echo "  chat      Open interactive chat with the Brains"
    echo "  logs      Follow Docker container logs"
    echo "  rebuild   Rebuild and restart all containers"
    echo ""
    echo "Examples:"
    echo "  ./soul up              # Start all containers"
    echo "  ./soul chat            # Interactive mode"
    echo "  ./soul chat /status    # Single command mode"
    ;;
esac
